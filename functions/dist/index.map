{"version":3,"sources":["index.ts"],"names":[],"mappings":"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","file":"index.map","sourceRoot":"../src","sourcesContent":["import * as functions from 'firebase-functions'\nimport * as admin from 'firebase-admin'\nimport moment from 'moment'\nimport express, * as Express from 'express'\nimport cors from 'cors'\n\nadmin.initializeApp()\n\nconst spendItemsApp = express()\n\nconst authenticate = async (\n  req: any,\n  res: Express.Response,\n  next: Express.NextFunction\n) => {\n  const authorization = req.get('Authorization')\n  if (authorization == null) {\n    res.send({ errors: ['Invalid authenticated.'] })\n    return\n  }\n\n  const idToken = authorization.split('Bearer ')[1]\n\n  console.log(`idToken: ${idToken}`)\n\n  const me = await admin\n    .auth()\n    .verifyIdToken(idToken)\n    .catch(error => {\n      console.error(error)\n      res.send('Invalid authenticated.')\n    })\n\n  req.me = me\n\n  next()\n}\nspendItemsApp.use([\n  cors({\n    origin: true,\n    methods: ['GET', 'PUT', 'POST', 'DELETE'],\n    allowedHeaders: ['Content-Type', 'Authorization'],\n  }),\n  authenticate,\n])\n\nspendItemsApp.post(\n  '/',\n  async (req: any, res): Promise<Express.Response> => {\n    const me = req.me\n\n    console.log(`me: ${me}`)\n\n    if (me == null) {\n      return res.send('Invalid authenticated.')\n    }\n\n    const spend = req.body.spend\n\n    console.log(`spend: ${spend}`)\n\n    const db = admin.firestore()\n    db.collection('items').add({\n      price: Number(spend),\n      userUid: me.uid,\n      createdAt: moment().format('YYYY/MM/DD HH:mm:ss'),\n    })\n\n    return res.send('Hello from Firebase!')\n  }\n)\n\nspendItemsApp.delete(\n  '/:id',\n  async (req: any, res): Promise<Express.Response> => {\n    const me = req.me\n\n    console.log(`me: ${me}`)\n\n    if (me == null) {\n      return res.send('Invalid authenticated.')\n    }\n    console.log(`req.params.id: ${req.params.id}`)\n\n    const db = admin.firestore()\n    const docRef = db.collection('items').doc(req.params.id)\n\n    const doc = await docRef.get()\n    console.log(`doc ${doc.id}`)\n    if (!doc.exists) return res.send('Invalid doc id.')\n    const data = doc.data()\n    if (data == null) return res.send('Invalid doc id.')\n    console.log(`data: ${data.userUid}`)\n    if (data.userUid != me.uid) return res.send('Invalid doc id.')\n\n    db.collection('items')\n      .doc(doc.id)\n      .delete()\n      .then(function() {\n        return res.send('Document successfully deleted!')\n      })\n      .catch(function(error) {\n        console.error('Error removing document: ', error)\n        return res.send('Fail to delete document.')\n      })\n\n    return res.send('Hello from Firebase!')\n  }\n)\n\nexports.spendItems = functions.https.onRequest(spendItemsApp)\n"]}